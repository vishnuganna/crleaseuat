const browser={getUserAgent:function(){return window.navigator.userAgent},userAgentContains:function(e){return e=e.toLowerCase(),-1<this.getUserAgent().toLowerCase().indexOf(e)},isOSX:function(){return this.userAgentContains("Macintosh")},isFirefox:function(){return this.userAgentContains("firefox")},isInternetExplorer:function(){return this.userAgentContains("trident")},isIE:function(){var e=this.getUserAgent().toLowerCase();return 0<e.indexOf("msie")||0<e.indexOf("trident/")},isEdge:function(){return 0<this.getUserAgent().toLowerCase().indexOf("edge")},isChrome:function(){var e=window.chrome;const n=window.navigator;var r=n.vendor,t=void 0!==window.opr,o=-1<n.userAgent.indexOf("Edge"),i=n.userAgent.match("CriOS");return null!=e&&"Google Inc."===r&&!1==t&&!1==o||i},isOpera:function(){return this.userAgentContains(" OPR/")}};let DEFAULT_CUSTOM_PROTOCOL_FAIL_CALLBACK_TIMEOUT;const registerEvent=(e,n,r)=>e.addEventListener?(e.addEventListener(n,r),{remove:function(){e.removeEventListener(n,r)}}):(e.attachEvent(n,r),{remove:function(){e.detachEvent(n,r)}}),createHiddenIframe=(e,n)=>{let r=document.createElement("iframe");return r.src=n,r.id="hiddenIframe",r.style.display="none",e.appendChild(r),r},openUriWithHiddenFrame=(e,n,r)=>{var t=setTimeout(function(){n(),i.remove()},DEFAULT_CUSTOM_PROTOCOL_FAIL_CALLBACK_TIMEOUT);let o=document.querySelector("#hiddenIframe");o=o||createHiddenIframe(document.body,"about:blank"),onBlur=()=>{clearTimeout(t),i.remove(),r()};const i=registerEvent(window,"blur",onBlur);o.contentWindow.location.href=e},openUriWithTimeoutHack=(e,n,r)=>{var t=setTimeout(function(){n(),i.remove()},DEFAULT_CUSTOM_PROTOCOL_FAIL_CALLBACK_TIMEOUT);let o=window;for(;o.parent&&o!=o.parent;)o=o.parent;onBlur=()=>{clearTimeout(t),i.remove(),r()};const i=registerEvent(o,"blur",onBlur);window.location=e},openUriUsingFirefox=(e,n,r)=>{let t=document.querySelector("#hiddenIframe");t=t||createHiddenIframe(document.body,"about:blank");try{t.contentWindow.location.href=e,r()}catch(e){"NS_ERROR_UNKNOWN_PROTOCOL"==e.name&&n()}},openUriWithMsLaunchUri=(e,n,r)=>{navigator.msLaunchUri(e,r,n)},getBrowserVersion=()=>{const e=window.navigator.userAgent;let n,r=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(r[1])?(n=/\brv[ :]+(\d+)/g.exec(e)||[],parseFloat(n[1])||""):"Chrome"===r[1]&&(n=e.match(/\b(OPR|Edge)\/(\d+)/),null!=n)?parseFloat(n[2]):(r=r[2]?[r[1],r[2]]:[window.navigator.appName,window.navigator.appVersion,"-?"],null!=(n=e.match(/version\/(\d+)/i))&&r.splice(1,1,n[1]),parseFloat(r[1]))},protocolCheck=(e,n,r,t=2e3,o)=>{var i=()=>{n&&n()},s=()=>{r&&r()},a=()=>{browser.isFirefox()?(64<=getBrowserVersion()?openUriWithHiddenFrame:openUriUsingFirefox)(e,i,s):browser.isChrome()?openUriWithTimeoutHack(e,i,s):browser.isOSX()?openUriWithHiddenFrame(e,i,s):o&&o()};if(t&&(DEFAULT_CUSTOM_PROTOCOL_FAIL_CALLBACK_TIMEOUT=t),browser.isEdge()||browser.isIE())openUriWithMsLaunchUri(e,n,r);else if(document.hasFocus())a();else{let e=registerEvent(window,"focus",()=>{e.remove(),a()})}};module.exports=protocolCheck;